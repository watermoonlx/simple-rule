## 组合规则

有多种方式可以组合规则。

对于少量的规则，可以利用`Rule<T>`的`and()`和`or()`方法进行组合：
```java
MockRule ruleA = new MockRule();
MockRule ruleB = new MockRule();
SerialRuleSet<String> ruleC = ruleA.and(ruleB); // ruleC要求同时满足ruleA和ruleB
SerialRuleSet<String> ruleD = ruleA.or(ruleB); // ruleD要求满足ruleA或ruleB其中一个
```

注意，组合产生的`RuleSet`，本身也是`Rule`，因此可以继续组合。这采用了设计模式中的“组合模式”。
```java
MockRule ruleA = new MockRule();
MockRule ruleB = new MockRule();
MockRule ruleC = new MockRule();

SerialRuleSet<String> ruleD = ruleA.and(ruleB).and(ruleC); // ruleD需要同时满足三个规则
```

对于数量较多的规则，可以使用静态方法`Rule.serial()`和`Rule.parallel()`进行组合：
```java
MockRule ruleA = new MockRule();
MockRule ruleB = new MockRule();
MockRule ruleC = new MockRule();
MockRule ruleD = new MockRule();
SerialRuleSet<String> ruleE = Rule.serial(ruleA, ruleB, ruleC, ruleD); // 依次检查A、B、C、D四个规则，都通过才算通过。

ParallelRuleSet<String> ruleF = Rule.parallel(ruleA, ruleB, ruleC, ruleD); // 并行检查A、B、C、D四个规则，都通过才算通过。
```

默认情况下，`Rule.serial()`和`Rule.parallel()`组合各个规则使用的运算符是`and`，也就是要求所有规则都通过，组合后的规则集才算通过。可以通过传入不同的运算符来修改该行为：
```java
MockRule ruleA = new MockRule();
MockRule ruleB = new MockRule();
MockRule ruleC = new MockRule();
MockRule ruleD = new MockRule();
SerialRuleSet<String> ruleE = Rule.serial(
    RuleSet.Operator.OR,
    ruleA, ruleB, ruleC, ruleD); // 依次检查A、B、C、D四个规则，只要有一个通过就算通过。

ParallelRuleSet<String> ruleF = Rule.parallel(
    RuleSet.Operator.OR,
    ruleA, ruleB, ruleC, ruleD); // 并行检查A、B、C、D四个规则，只要有一个通过就算通过。
```

通过`Rule.serial()`和`Rule.parallel()`的嵌套使用，可以组合出复杂的规则集：
```java
SerialRuleSet<String> ruleSet = Rule.serial(
    rule1,
    Rule.parallel(
            Rule.parallel(
                    rule2,
                    Rule.serial(RuleSet.Operator.OR, rule3, rule4),
                    Rule.parallel(RuleSet.Operator.OR, rule5, rule6)),
            rule7
    )
```

## 规则集

对于需要反复使用的规则组合，可以直接创建一个规则集类，包含所有要使用的规则。待使用是只需要实例化该规则集类即可。

例：
```java
@Rule.Descriptor("订单规则集")
public class OrderRuleSet extends SerialRuleSet<Order> {
    public OrderRuleSet() {
        // 组合规则
        SerialRuleSet<Order> ruleSet = Rule.serial(
                new BuyerMustBeJake(),
                Rule.parallel(
                        new AmountMustBiggerThan500(),
                        new AmountMustLessThan1000()
                ),
                new CreateTimeMustIn2020()
        );
        // 注册规则集
        this.register(ruleSet);
    }
}

...

    public static void main(String[] args) throws IOException {

        // 1. 创建订单
        Order order = new Order("Jake", 1200, LocalDateTime.of(2019, 1, 1, 0, 0));

        // 2. 创建规则集
        OrderRuleSet orderRuleSet = new OrderRuleSet();

        // 3. 执行检查
        RuleCheckResult result = orderRuleSet.check(order);
    }
```

另外正如上面所述，任何`RuleSet`其实也是`Rule`，因此可以和别的规则任意组合。